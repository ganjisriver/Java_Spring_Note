# 다양한 연관관계 매핑

### 연관관계 매핑 시 고려사항 3가지

- 다중성 (1:N, N:1, M:N 등)

- 단방향, 양방향

- 연관관계의 주인

---

### 다중성

- 일대다 @OneToMany

- 다대일 @ManyToOne

- 일대일 @OneToOne

- 다대다 @ManyToMany -> 실무에서 사용하면 안됨.

대부분 다대일같은 경우, 연관관계의 주인은 다쪽에 갖는게 설계상 좋은 경우가 많다.



---

### 단방향, 양방향

- 테이블
  
  - 외래키 하나로 양쪽 테이블 조인 가능
  
  - 사실상 테이블에서는 방향성이 존재하지 않음

- 객체
  
  - 참조용 필드가 있는 쪽으로만 참조 가능
  
  - 한쪽만 참조를 하게 되면 단방향
  
  - 양쪽다 참조를 하게 되면 양방향이 됨

양방향과 단방향을 구분하는 예시는 아래와 같다.

---

#### 양방향

- 야구팀과 야구선수 테이블이 있다고 가정하자.

- 야구팀에과 야구선수는 일반적으로 생각할 때, 일대다 관게다.

- 신세계 야구팀에 어느 선수가 있는지 보고 싶은지에 대한 수요가 있을 것이다. 이러면, 야구팀에서 어느 선수가 있는지에 대한 참조를 하게 될 것이다.

- 반대로, 어느 선수가 어느 야구팀에 속해있는지 보고 싶어하는 수요가 있을 것이다. 이러면 야구 선수테이블에서도 야구팀 객체를 참조하게 될 것이다.

- 이러면 야구팀과 야구선수의 양방향이 성립되는 것이다.

---

#### 단방향

- 쿠팡에서 주문과 상품이 있을 것이다.

- 주문과 상품은 일반적으로 생각할 때, 주문이 1, 상품이 다인 일대다 관계이다. 

- 유저가 주문 장바구니에 상품을 넣고 주문을 시킬 경우에, 그 주문에 속해있는 상품을 보고 싶어하는 수요가 있을 것이다.

- 그렇기 때문에, 주문테이블은 상품을 참조할 것이고, 주문은 상품에 대한 방향성이 생긴다.

- 하지만 특정 상품을 볼 때, 어느 주문인가에 대한 수요는 굳이 있을 것 같지가 않다.

- 그렇다면 상품은 주문을 굳이 참조할 필요가 없다. 그렇다면 상품 객체는 주문을 참조할 필요가 없어진다.

- 이러한 상황이 주문만이 상품을 참조하고, 역관계는 성립하지 않는 단방향 관계가 성립한다.

---

#### 다대일

- **단방향**
  
  - 가장 많이 사용하는 연관관계이다.

- **양방향**
  
  - 외래 키가 있는 쪽이 연관관계의 주인, 양쪽을 서로 참조하도록 개발

---

#### 일대다

- **단방향**
  
  - 일대다 단방향은 1이 연관관계의 주인이다.
  
  - 테이블 일대다 관계는 다쪽에 외래 키가 존재함.
  
  - @JoinColumn을 사용하지 않으면 조인 테이블을 하나 자동 생성한다.
    
    - 중간에 테이블이 하나 더 생성하면, 성능이 떨어지고, 관리하기도 불편할 경우가 생김

- **단방향 단점**
  
  - 엔티티가 관리하는 외래 키가 다른 테이블에 존재함.
  
  - 연관관계 관리를 위해 **UPDATE 쿼리문을 추가로 실행**한다. 
    
    - 자신의 테이블을 바꾸는데, 외래 키가 다른 테이블에 존재하기 때문에, 해당 컬럼을 업데이트 해주기 위해서, UPDATE문을 실행 시킬 수 밖에 없는 구조.
  
  - 일대다 단뱡항 매핑보다 **다대일 양방향 매핑이 차라리 낫다.**

- **양방향**
  
  - 일대다 양방향은 공식적으로 존재하지 않는 매핑이다.
  
  - @JoinColumn(insertable=false, updatable=false) 어노테이션을 사용함으로써, 강제로 읽기 전용 컬럼으로 만들어주는 매핑을 사용해야함.
  
  - 다대일 양방향을 사용하는 것이 유지보수에 편하다.

---

#### 일대일

- 일반적으로, 외래 키에 데이터베이스 UNI 제약조건을 추가한다.
  
  - UNI 제약조건을 달지 않으면, 고려사항이 많아지게됨.

- 일대일에서도 다대일과 마찬가지로, 연관관계의 주인이 있다.

- 다대일에서와 마찬가지로 @ManyToOne 대신 @OneToOne, @JoinColumn달아주고, 알아서 한쪽에 외래키 달아주고 mappedby를 반대쪽에 달아주면 된다.

---

#### 다대다

- 관계형 DB는 두개의 테이블로 다대다 관계를 표현할 수 없음.

- 객체의 경우 컬렉션을 이용하여 객체 2개로 다대다 관계를 표현할 수 있다.

- 하지만 DB는 중계 테이블을 만들어서 다대일 관계로 풀어내야함.

<img src="file:///C:/Users/SSAFY/AppData/Roaming/marktext/images/2023-03-10-10-48-04-image.png" title="" alt="" width="500">

- @ManyToMany라는 어노테이션이 있고, , 실무에서 사용하지 않음


